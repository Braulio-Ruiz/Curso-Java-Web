<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso Java Profesional - M√≥dulo 6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <style>
        header {
            cursor: pointer;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
        }

        .code-block {
            border-radius: 0.5rem;
            overflow: hidden;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .lesson-section {
            display: none;
        }

        .lesson-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        h2 {
            color: #1e3a8a;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: bold;
            font-size: 1.5rem;
        }

        h3 {
            color: #1f2937;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .nav-btn {
            transition: all 0.3s;
        }

        .nav-btn.active {
            background-color: #2563eb;
            color: white;
            border-left: 4px solid #1e40af;
        }

        .tip-box {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .warning-box {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .best-practice {
            background-color: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .exercise-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .difficulty-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }

        .badge-yellow {
            background-color: #fef9c3;
            color: #854d0e;
        }

        .badge-red {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .solution-spoiler {
            display: none;
            background: #1f2937;
            color: #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            border-left: 4px solid #059669;
        }
    </style>
</head>

<body class="flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header onclick="window.location.href='../index.html'"
        class="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center z-10 hover:bg-slate-800 transition">
        <div>
            <h1 class="text-2xl font-bold tracking-tight">‚òï Curso Profesional de Java</h1>
            <p class="text-slate-400 text-sm">M√≥dulo 6: Persistencia de Datos y Backend</p>
        </div>
        <div class="text-xs bg-emerald-600 px-3 py-1 rounded-full font-semibold">Java 21 LTS</div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar Navigation -->
        <nav class="w-64 bg-white shadow-md overflow-y-auto hidden md:block border-r border-gray-200">
            <div class="p-4">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">Temario del M√≥dulo</h3>
                <div class="space-y-1">
                    <button onclick="showLesson(25)" id="btn-25"
                        class="nav-btn active w-full text-left px-4 py-3 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                        25: SQL y JDBC
                    </button>
                    <button onclick="showLesson(26)" id="btn-26"
                        class="nav-btn w-full text-left px-4 py-3 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                        26: Intro a JPA y ORM
                    </button>
                    <button onclick="showLesson(27)" id="btn-27"
                        class="nav-btn w-full text-left px-4 py-3 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">
                        27: JSON (Jackson)
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-8 relative scroll-smooth">

            <!-- LECCI√ìN 25 -->
            <div id="lesson-25" class="lesson-section active max-w-4xl mx-auto">
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <span class="text-emerald-600 font-bold tracking-wide text-sm uppercase">Lecci√≥n 25</span>
                    <h1 class="text-4xl font-extrabold text-gray-900 mt-2">Fundamentos de SQL y JDBC</h1>
                </div>

                <div class="bg-emerald-50 p-6 rounded-lg mb-8 border border-emerald-100">
                    <h3 class="text-emerald-800 font-bold mb-2 !mt-0">üéØ Objetivos de √âlite</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Entender la "fontaner√≠a" de los datos: Drivers, Connections y Statements.</li>
                        <li>Ciberseguridad 101: Por qu√© concatenar SQL es un crimen (`PreparedStatement`).</li>
                        <li>Gesti√≥n de Transacciones: Commit, Rollback y la atomicidad (ACID).</li>
                        <li>Arquitectura Limpia: El patr√≥n DAO para desacoplar la base de datos de la l√≥gica.</li>
                    </ul>
                </div>

                <h2>1. Teor√≠a Suprema: El Puente hacia los Datos</h2>
                <p class="text-gray-700 mb-4">
                    [Image of SQL Database connection diagram]
                    JDBC (Java Database Connectivity) es la API de bajo nivel. Aunque uses frameworks modernos
                    (Hibernate, Spring Data), debajo siempre hay JDBC.
                    <br>
                    <strong>El Driver</strong> es el traductor. Java habla "M√©todos Java" y el Driver los traduce a
                    "Protocolo TCP de MySQL/Postgres" a trav√©s del cable.
                </p>

                <h3 class="text-lg font-bold text-gray-800">1.1 Inyecci√≥n SQL: El Error #1 de OWASP</h3>
                <div class="warning-box">
                    <strong>Peligro Mortal:</strong>
                    <br>Jam√°s hagas esto: `sql = "SELECT * FROM users WHERE pass = '" + pass + "'"`
                    <br>Si yo pongo como password `' OR '1'='1`, la consulta se vuelve `WHERE pass = '' OR '1'='1'`, lo
                    cual siempre es TRUE. Acabo de hackear tu sistema.
                    <br><strong>Soluci√≥n:</strong> `PreparedStatement`. Env√≠a la consulta y los datos por separado. El
                    motor de BD trata los datos como literales, no como c√≥digo ejecutable.
                </div>

                <h2>2. Laboratorio de C√≥digo</h2>
                <div class="code-block">
                    <pre><code class="language-java">import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class UsuarioDAO {
    // En producci√≥n, usa un Connection Pool (HikariCP), no DriverManager directo.
    private static final String URL = "jdbc:h2:mem:testdb"; 
    private static final String USER = "sa";
    private static final String PASS = "";

    public List<Usuario> buscarPorRol(String rol) {
        String sql = "SELECT id, nombre, email FROM usuarios WHERE rol = ?";
        List<Usuario> usuarios = new ArrayList<>();

        // try-with-resources cierra la conexi√≥n y el statement autom√°ticamente
        try (Connection conn = DriverManager.getConnection(URL, USER, PASS);
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            // 1. Asignaci√≥n Segura (Previene Inyecci√≥n SQL)
            stmt.setString(1, rol);

            // 2. Ejecuci√≥n
            try (ResultSet rs = stmt.executeQuery()) {
                // 3. Mapeo Relacional -> Objetos (Manual)
                while (rs.next()) {
                    Usuario u = new Usuario(
                        rs.getLong("id"),
                        rs.getString("nombre"),
                        rs.getString("email")
                    );
                    usuarios.add(u);
                }
            }
        } catch (SQLException e) {
            // Logging profesional y relanzamiento como RuntimeException
            System.err.println("Error DB: " + e.getMessage());
            throw new RuntimeException("Error al buscar usuarios", e);
        }
        return usuarios;
    }
}</code></pre>
                </div>

                <h2>3. Entrenamiento Progresivo</h2>

                <!-- EJERCICIO 1: VERDE -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-green">Nivel B√°sico</span>
                    <h4 class="font-bold text-gray-800 pr-20">Conexi√≥n H2</h4>
                    <p class="text-gray-600 mt-2">Configura una base de datos H2 en memoria. Escribe un m√©todo que se
                        conecte y ejecute `CREATE TABLE productos (id INT PRIMARY KEY, nombre VARCHAR(255))`.</p>
                </div>

                <!-- EJERCICIO 2: AMARILLO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-yellow">Nivel Intermedio</span>
                    <h4 class="font-bold text-gray-800 pr-20">Inserci√≥n con ID Autogenerado</h4>
                    <p class="text-gray-600 mt-2">Inserta un producto "Laptop" en la tabla. Recupera el ID que la base
                        de datos le asign√≥ autom√°ticamente. <br>Pista: Usa `Statement.RETURN_GENERATED_KEYS` al preparar
                        el statement y luego `stmt.getGeneratedKeys()`.</p>
                </div>

                <!-- EJERCICIO 3: ROJO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-red">Nivel Experto</span>
                    <h4 class="font-bold text-gray-800 pr-20">Transacci√≥n Bancaria At√≥mica</h4>
                    <p class="text-gray-600 mt-2">Simula una transferencia entre dos cuentas. Debes hacer dos UPDATEs.
                        <br>1. Desactiva el auto-commit (`conn.setAutoCommit(false)`). <br>2. Resta saldo a A. <br>3.
                        Suma saldo a B. <br>4. Si algo falla (ej: excepci√≥n simulada entre los pasos), haz `rollback()`.
                        Si todo va bien, `commit()`. Demuestra que si falla, el dinero no desaparece.</p>

                    <button onclick="toggleSolution('sol-25')"
                        class="mt-3 text-sm font-semibold text-emerald-600 hover:text-emerald-800 underline">
                        üëÅÔ∏è Ver Soluci√≥n Gu√≠a
                    </button>

                    <div id="sol-25" class="solution-spoiler">
                        <pre><code class="language-java">try (Connection conn = DriverManager.getConnection(URL, USER, PASS)) {
    conn.setAutoCommit(false); // Inicio Transacci√≥n
    try {
        // ... update restar ...
        // ... update sumar ...
        conn.commit(); // Confirmar cambios
    } catch (Exception e) {
        conn.rollback(); // Deshacer cambios
        throw new RuntimeException("Transferencia fallida", e);
    }
}</code></pre>
                    </div>
                </div>

                <h2>4. Evaluaci√≥n de Conceptos</h2>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 space-y-4">
                    <div>
                        <p class="font-semibold text-gray-800">1. ¬øQu√© es `ResultSet`?</p>
                        <select id="q25-1" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Una lista de Strings con los datos.</option>
                            <option value="b">Un cursor que apunta a los resultados de la consulta, permitiendo iterar
                                fila por fila.</option>
                            <option value="c">La conexi√≥n a la base de datos.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">2. ¬øPor qu√© `PreparedStatement` previene inyecci√≥n SQL?
                        </p>
                        <select id="q25-2" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Porque encripta los datos.</option>
                            <option value="b">Porque separa la estructura de la consulta de los datos, tratando los
                                par√°metros como valores puros.</option>
                            <option value="c">Porque es m√°s r√°pido.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">3. ¬øQu√© hace `rollback()`?</p>
                        <select id="q25-3" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Borra la base de datos.</option>
                            <option value="b">Cierra la conexi√≥n.</option>
                            <option value="c">Deshace todos los cambios realizados en la transacci√≥n actual.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">4. ¬øQu√© es el patr√≥n DAO?</p>
                        <select id="q25-4" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Data Access Object: Encapsula el acceso a la fuente de datos.</option>
                            <option value="b">Direct Access Object: Acceso directo a memoria.</option>
                            <option value="c">Un tipo de base de datos.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">5. ¬øQu√© m√©todo usamos para ejecutar un UPDATE, INSERT o
                            DELETE?</p>
                        <select id="q25-5" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">executeQuery()</option>
                            <option value="b">executeUpdate()</option>
                            <option value="c">executeChange()</option>
                        </select>
                    </div>
                    <button onclick="checkQuiz1()"
                        class="bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 w-full font-bold">Validar
                        Conocimientos</button>
                </div>
            </div>

            <!-- LECCI√ìN 26 -->
            <div id="lesson-26" class="lesson-section max-w-4xl mx-auto">
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <span class="text-emerald-600 font-bold tracking-wide text-sm uppercase">Lecci√≥n 26</span>
                    <h1 class="text-4xl font-extrabold text-gray-900 mt-2">Introducci√≥n a JPA y ORM</h1>
                </div>

                <div class="bg-emerald-50 p-6 rounded-lg mb-8 border border-emerald-100">
                    <h3 class="text-emerald-800 font-bold mb-2 !mt-0">üéØ Objetivos de √âlite</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Resolver el "Impedance Mismatch": Objetos vs Tablas.</li>
                        <li>Entender el <strong>Ciclo de Vida de la Entidad</strong>: Transient, Managed, Detached,
                            Removed.</li>
                        <li>Evitar el problema N+1 en consultas.</li>
                        <li>JPQL: Consultar objetos, no tablas.</li>
                    </ul>
                </div>

                <h2>1. Teor√≠a Suprema: La Magia (y Peligros) del ORM</h2>
                <p class="text-gray-700 mb-4">
                    [Image of ORM mapping diagram]
                    JPA (Java Persistence API) automatiza el tedioso trabajo de JDBC. Mapea tus clases (`@Entity`) a
                    tablas.
                    <br>
                    <strong>Concepto Cr√≠tico: Persistence Context (La Cach√© de Primer Nivel)</strong>. Cuando cargas un
                    objeto con JPA, no es un objeto normal; est√° "vigilado" (Managed). Si le cambias un atributo
                    (`user.setName("X")`), JPA detecta el cambio autom√°ticamente y har√° el UPDATE en la BD al cerrar la
                    transacci√≥n (Dirty Checking). ¬°No necesitas llamar a `save()` si est√° Managed!
                </p>

                <h3 class="text-lg font-bold text-gray-800">1.1 Eager vs Lazy Loading</h3>
                <div class="warning-box">
                    <strong>Rendimiento:</strong>
                    <br>Si tienes `Usuario` -> `Pedidos` (`OneToMany`).
                    <br><strong>Eager (Ansioso):</strong> Al cargar usuario, trae TODOS sus pedidos. Si tiene 1000, te
                    comes la memoria.
                    <br><strong>Lazy (Perezoso - Recomendado):</strong> Solo trae el usuario. Los pedidos se cargan SOLO
                    si accedes a `usuario.getPedidos()`. Cuidado: Si la sesi√≥n de BD ya se cerr√≥, lanzar√°
                    `LazyInitializationException`.
                </div>

                <h2>2. Laboratorio de C√≥digo</h2>
                <div class="code-block">
                    <pre><code class="language-java">import jakarta.persistence.*;

@Entity // 1. Marca la clase
@Table(name = "empleados")
public class Empleado {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String nombre;
    
    // Constructores, Getters...
}

public class JpaDemo {
    public void cicloDeVida(EntityManager em) {
        // 1. Transient: Solo en memoria Java, JPA no lo conoce
        Empleado e = new Empleado("Ana"); 

        em.getTransaction().begin();
        
        // 2. Managed: Ahora JPA lo vigila. Se har√° INSERT al commit.
        em.persist(e); 
        
        // ¬°Magia! No necesito llamar a update/save.
        // Como est√° Managed, JPA detecta el cambio y programa un UPDATE.
        e.setNombre("Ana Mar√≠a"); 
        
        em.getTransaction().commit(); 
        // 3. Detached: Al cerrar el EM o transacci√≥n, el objeto pierde la conexi√≥n.
        // Cambios aqu√≠ ya no se guardan solos.
    }
}</code></pre>
                </div>

                <h2>3. Entrenamiento Progresivo</h2>

                <!-- EJERCICIO 1: VERDE -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-green">Nivel B√°sico</span>
                    <h4 class="font-bold text-gray-800 pr-20">Mapeo B√°sico</h4>
                    <p class="text-gray-600 mt-2">Crea una entidad `Libro` con `isbn` (String, @Id), `titulo` y `autor`.
                        A√±ade la configuraci√≥n en `persistence.xml` (o Spring Boot properties) para que muestre el SQL
                        generado en consola (`show-sql`).</p>
                </div>

                <!-- EJERCICIO 2: AMARILLO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-yellow">Nivel Intermedio</span>
                    <h4 class="font-bold text-gray-800 pr-20">JPQL (Java Persistence Query Language)</h4>
                    <p class="text-gray-600 mt-2">Escribe una consulta JPQL para buscar todos los libros de un autor
                        espec√≠fico. <br>Nota: En JPQL seleccionas <strong>Entidades</strong> (`FROM Libro l`), no tablas
                        (`FROM libros`).</p>
                </div>

                <!-- EJERCICIO 3: ROJO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-red">Nivel Experto</span>
                    <h4 class="font-bold text-gray-800 pr-20">Relaciones y Cascada</h4>
                    <p class="text-gray-600 mt-2">Modela `Autor` (1) <-> `Libro` (N). Usa `@OneToMany(mappedBy="autor",
                            cascade=CascadeType.PERSIST)`. <br>Crea un Autor, a√±√°dele 2 libros a su lista, y guarda
                            <strong>solo al Autor</strong>. Verifica que los libros se insertaron autom√°ticamente en la
                            BD por el efecto cascada.</p>

                    <button onclick="toggleSolution('sol-26')"
                        class="mt-3 text-sm font-semibold text-emerald-600 hover:text-emerald-800 underline">
                        üëÅÔ∏è Ver Soluci√≥n Gu√≠a
                    </button>

                    <div id="sol-26" class="solution-spoiler">
                        <pre><code class="language-java">// En Autor.java
@OneToMany(mappedBy = "autor", cascade = CascadeType.PERSIST)
private List<Libro> libros = new ArrayList<>();

// En Main
Autor autor = new Autor("King");
Libro l1 = new Libro("It");
l1.setAutor(autor); // Importante: relaci√≥n bidireccional
autor.getLibros().add(l1);

em.persist(autor); // Guarda autor Y libro autom√°ticamente</code></pre>
                    </div>
                </div>

                <h2>4. Evaluaci√≥n de Conceptos</h2>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 space-y-4">
                    <div>
                        <p class="font-semibold text-gray-800">1. ¬øQu√© significa que una entidad est√© "Detached"?</p>
                        <select id="q26-1" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Que ha sido borrada de la BD.</option>
                            <option value="b">Que existe en BD pero no est√° siendo vigilada por el EntityManager actual.
                            </option>
                            <option value="c">Que es nueva y no tiene ID.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">2. ¬øCu√°ndo ocurre el Dirty Checking?</p>
                        <select id="q26-2" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Al hacer em.persist().</option>
                            <option value="b">Al hacer commit de la transacci√≥n.</option>
                            <option value="c">Instant√°neamente al usar un setter.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">3. ¬øQu√© problema soluciona `FetchType.LAZY`?</p>
                        <select id="q26-3" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Carga lenta de la aplicaci√≥n.</option>
                            <option value="b">Carga innecesaria de datos relacionados masivos en memoria.</option>
                            <option value="c">Errores de conexi√≥n.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">4. ¬øQu√© es JPQL?</p>
                        <select id="q26-4" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Un driver de base de datos.</option>
                            <option value="b">Un lenguaje de consulta orientado a objetos, independiente de la BD SQL.
                            </option>
                            <option value="c">Una librer√≠a de JSON.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">5. ¬øQu√© anotaci√≥n define la clave primaria?</p>
                        <select id="q26-5" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">@Key</option>
                            <option value="b">@Primary</option>
                            <option value="c">@Id</option>
                        </select>
                    </div>
                    <button onclick="checkQuiz1()"
                        class="bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 w-full font-bold">Validar
                        Conocimientos</button>
                </div>
            </div>

            <!-- LECCI√ìN 27 -->
            <div id="lesson-27" class="lesson-section max-w-4xl mx-auto">
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <span class="text-emerald-600 font-bold tracking-wide text-sm uppercase">Lecci√≥n 27</span>
                    <h1 class="text-4xl font-extrabold text-gray-900 mt-2">Formatos de Intercambio (JSON)</h1>
                </div>

                <div class="bg-emerald-50 p-6 rounded-lg mb-8 border border-emerald-100">
                    <h3 class="text-emerald-800 font-bold mb-2 !mt-0">üéØ Objetivos de √âlite</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>El lenguaje universal de la web: JSON.</li>
                        <li>Serializaci√≥n (Marshalling) vs Deserializaci√≥n (Unmarshalling).</li>
                        <li>Dominar <strong>Jackson</strong>: La librer√≠a est√°ndar de facto en Java.</li>
                        <li>Seguridad y Dise√±o: Por qu√© usar DTOs (Data Transfer Objects) y nunca Entidades en la API.
                        </li>
                    </ul>
                </div>

                <h2>1. Teor√≠a Suprema: La Lingua Franca</h2>
                <p class="text-gray-700 mb-4">
                    Tus objetos Java viven en el Heap (RAM). Para enviarlos a un Frontend (React) o a otro
                    Microservicio, deben viajar como texto. JSON es ligero y legible.
                    <br>
                    <strong>Jackson</strong> usa <em>Reflection</em> para leer tus objetos privados y convertirlos a
                    texto.
                </p>

                <div class="warning-box">
                    <strong>Anti-Patr√≥n: Exponer Entidades</strong>
                    <br>Nunca devuelvas una `@Entity` JPA directamente en un controlador REST.
                    <br>1. <strong>Seguridad:</strong> Podr√≠as exponer el `password` o datos internos.
                    <br>2. <strong>Rendimiento:</strong> Podr√≠as disparar una carga Lazy de toda la base de datos (N+1)
                    al serializar.
                    <br>3. <strong>Acoplamiento:</strong> Si cambias la BD, rompes la API p√∫blica.
                    <br><strong>Soluci√≥n:</strong> Usa **DTOs** (Records son perfectos para esto).
                </div>

                <h2>2. Laboratorio de C√≥digo</h2>
                <div class="code-block">
                    <pre><code class="language-java">import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.annotation.JsonIgnore;

public class JsonDemo {
    
    // DTO inmutable usando Record (Ideal para JSON)
    // @JsonIgnore evita que el campo password salga en el JSON
    public record UsuarioDTO(String nombre, String email, @JsonIgnore String password) {}

    public static void main(String[] args) throws Exception {
        ObjectMapper mapper = new ObjectMapper();

        // 1. Serializaci√≥n (Java -> JSON)
        UsuarioDTO user = new UsuarioDTO("Carlos", "carlos@mail.com", "12345");
        
        String json = mapper.writeValueAsString(user);
        System.out.println(json); 
        // Salida: {"nombre":"Carlos","email":"carlos@mail.com"} 
        // (Password oculto)

        // 2. Deserializaci√≥n (JSON -> Java)
        String inputJson = "{\"nombre\":\"Ana\",\"email\":\"ana@test.com\",\"extra\":\"ignorar\"}";
        
        // Configuraci√≥n para ser tolerante a cambios (ignorar campos extra desconocidos)
        // mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        
        UsuarioDTO ana = mapper.readValue(inputJson, UsuarioDTO.class);
        System.out.println("Java: " + ana.nombre());
    }
}</code></pre>
                </div>

                <h2>3. Entrenamiento Progresivo</h2>

                <!-- EJERCICIO 1: VERDE -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-green">Nivel B√°sico</span>
                    <h4 class="font-bold text-gray-800 pr-20">Hola Jackson</h4>
                    <p class="text-gray-600 mt-2">Crea una clase POJO `Producto` (nombre, precio). Instancia uno. Usa
                        `ObjectMapper` para imprimir su representaci√≥n JSON en la consola.</p>
                </div>

                <!-- EJERCICIO 2: AMARILLO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-yellow">Nivel Intermedio</span>
                    <h4 class="font-bold text-gray-800 pr-20">Configuraci√≥n Robusta</h4>
                    <p class="text-gray-600 mt-2">Configura el `ObjectMapper` para: <br>1. "Pretty Print" (Indentaci√≥n
                        bonita). <br>2. Ignorar propiedades desconocidas (`FAIL_ON_UNKNOWN_PROPERTIES = false`).
                        <br>Prueba deserializar un JSON que tenga un campo "basura" que no existe en tu clase Java.</p>
                </div>

                <!-- EJERCICIO 3: ROJO -->
                <div class="exercise-card">
                    <span class="difficulty-badge badge-red">Nivel Experto</span>
                    <h4 class="font-bold text-gray-800 pr-20">Fechas Modernas en JSON</h4>
                    <p class="text-gray-600 mt-2">Por defecto, Jackson falla con `LocalDate` o lo serializa como un
                        array de n√∫meros `[2023, 10, 5]`. <br>Agrega el m√≥dulo `JavaTimeModule` al mapper y config√∫ralo
                        para que no escriba fechas como timestamps. Logra que el JSON salga como `"2023-10-05"`
                        (ISO-8601).</p>

                    <button onclick="toggleSolution('sol-27')"
                        class="mt-3 text-sm font-semibold text-emerald-600 hover:text-emerald-800 underline">
                        üëÅÔ∏è Ver Soluci√≥n Gu√≠a
                    </button>

                    <div id="sol-27" class="solution-spoiler">
                        <pre><code class="language-java">import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import com.fasterxml.jackson.databind.SerializationFeature;

ObjectMapper mapper = new ObjectMapper();
mapper.registerModule(new JavaTimeModule()); // Soporte para java.time
mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS); // Formato ISO

LocalDate fecha = LocalDate.now();
System.out.println(mapper.writeValueAsString(fecha)); // "2023-10-27"</code></pre>
                    </div>
                </div>

                <h2>4. Evaluaci√≥n de Conceptos</h2>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 space-y-4">
                    <div>
                        <p class="font-semibold text-gray-800">1. ¬øQu√© es la serializaci√≥n?</p>
                        <select id="q27-1" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Convertir JSON a Java.</option>
                            <option value="b">Convertir Objeto Java a texto (JSON/XML).</option>
                            <option value="c">Guardar en base de datos.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">2. ¬øPara qu√© sirve @JsonIgnore?</p>
                        <select id="q27-2" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Para que Jackson ignore un campo al leer o escribir.</option>
                            <option value="b">Para ignorar errores.</option>
                            <option value="c">Para borrar el campo de la clase.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">3. ¬øQu√© es un DTO?</p>
                        <select id="q27-3" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">Un objeto complejo con l√≥gica de negocio.</option>
                            <option value="b">Database Transaction Object.</option>
                            <option value="c">Data Transfer Object: Un contenedor simple de datos para transporte.
                            </option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">4. ¬øC√≥mo maneja Jackson los campos privados?</p>
                        <select id="q27-4" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">No puede leerlos.</option>
                            <option value="b">Usa Reflection y Getters/Setters para acceder.</option>
                            <option value="c">Exige que sean p√∫blicos.</option>
                        </select>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">5. ¬øPor qu√© es mala idea devolver Entidades JPA en un
                            endpoint REST?</p>
                        <select id="q27-5" class="w-full p-2 border rounded mt-1">
                            <option value="">Elegir...</option>
                            <option value="a">No es malo, es m√°s r√°pido.</option>
                            <option value="b">Por seguridad, acoplamiento y posibles problemas de recursi√≥n infinita o
                                carga perezosa.</option>
                            <option value="c">Porque JSON no soporta objetos.</option>
                        </select>
                    </div>
                    <button onclick="checkQuiz1()"
                        class="bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 w-full font-bold">Validar
                        Conocimientos</button>
                </div>
            </div>

        </main>
    </div>

    <!-- Scripts para interactividad -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script>
        function showLesson(id) {
            document.querySelectorAll('.lesson-section').forEach(el => {
                el.classList.remove('active');
                el.style.display = 'none';
            });
            const selected = document.getElementById('lesson-' + id);
            selected.style.display = 'block';
            setTimeout(() => selected.classList.add('active'), 10);

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + id).classList.add('active');
            document.querySelector('main').scrollTop = 0;
        }

        function toggleSolution(id) {
            const el = document.getElementById(id);
            if (el.style.display === 'block') el.style.display = 'none';
            else el.style.display = 'block';
        }

        // Validaci√≥n simple para Quiz
        function checkQuiz1() {
            alert("¬°Respuestas registradas! Est√°s listo para construir Backends reales.");
        }

        // Init
        showLesson(25);
    </script>
</body>

</html>